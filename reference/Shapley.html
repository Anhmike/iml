<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Prediction explanations with game theory — Shapley • iml</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Prediction explanations with game theory — Shapley" />
<meta property="og:description" content="Shapley computes feature contributions for single predictions with the
Shapley value, an approach from cooperative game theory. The features values
of an instance cooperate to achieve the prediction. The Shapley value fairly
distributes the difference of the instance's prediction and the datasets
average prediction among the features." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">iml</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/intro.html">Introduction to iml: Interpretable Machine Learning in R</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel computation of interpretation methods</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/christophM/iml/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Prediction explanations with game theory</h1>
    <small class="dont-index">Source: <a href='https://github.com/christophM/iml/blob/master/R/Shapley.R'><code>R/Shapley.R</code></a></small>
    <div class="hidden name"><code>Shapley.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>Shapley</code> computes feature contributions for single predictions with the
Shapley value, an approach from cooperative game theory. The features values
of an instance cooperate to achieve the prediction. The Shapley value fairly
distributes the difference of the instance's prediction and the datasets
average prediction among the features.</p>
    </div>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For more details on the algorithm see
<a href='https://christophm.github.io/interpretable-ml-book/shapley.html'>https://christophm.github.io/interpretable-ml-book/shapley.html</a></p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Strumbelj, E., Kononenko, I. (2014). Explaining prediction models and
individual predictions with feature contributions. Knowledge and Information
Systems, 41(3), 647-665. https://doi.org/10.1007/s10115-013-0679-x</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Shapley</p>
<p>A different way to explain predictions: <a href='LocalModel.html'>LocalModel</a></p></div>
    <h2 class="hasAnchor" id="super-class"><a class="anchor" href="#super-class"></a>Super class</h2>

    <p><code><a href='InterpretationMethod.html'>iml::InterpretationMethod</a></code> -&gt; <code>Shapley</code></p>
    <h2 class="hasAnchor" id="public-fields"><a class="anchor" href="#public-fields"></a>Public fields</h2>

    <p><div class="r6-fields"></p><dl'>
<dt><code>x.interest</code></dt><dd><p><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a><br />
Single row with the instance to be explained.</p></dd>

<dt><code>y.hat.interest</code></dt><dd><p><a href='https://rdrr.io/r/base/numeric.html'>numeric</a><br />
Predicted value for instance of interest.</p></dd>

<dt><code>y.hat.average</code></dt><dd><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code><br />
Average predicted value for data <code>X</code>.</p></dd>

<dt><code>sample.size</code></dt><dd><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code><br />
The number of times coalitions/marginals are
sampled from data X. The higher the more accurate the explanations
become.</p></dd>

</dl><p></div></p>
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    
<h3>Public methods</h3>

<ul>
<li><p><a href='#method-new'><code>Shapley$new()</code></a></p></li>
<li><p><a href='#method-explain'><code>Shapley$explain()</code></a></p></li>
<li><p><a href='#method-clone'><code>Shapley$clone()</code></a></p></li>
</ul>
<p><details open ><summary>Inherited methods</summary>
<ul>
<li><p><span class="pkg-link" data-pkg="iml" data-topic="InterpretationMethod" data-id="plot"><a href='../../iml/html/InterpretationMethod.html#method-plot'><code>iml::InterpretationMethod$plot()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="iml" data-topic="InterpretationMethod" data-id="print"><a href='../../iml/html/InterpretationMethod.html#method-print'><code>iml::InterpretationMethod$print()</code></a></span></p></li>
</ul>
</details>

<hr>
<a id="method-new"></a></p><h3>Method <code>new()</code></h3>
<p>Create a Shapley object</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>Shapley</span>$<span class='fu'>new</span>(<span class='no'>predictor</span>, <span class='kw'>x.interest</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>sample.size</span> <span class='kw'>=</span> <span class='fl'>100</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>predictor</code></dt><dd><p><a href='Predictor.html'>Predictor</a><br />
The object (created with <code>Predictor$new()</code>) holding the machine
learning model and the data.</p></dd>

<dt><code>x.interest</code></dt><dd><p><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a><br />
Single row with the instance to be explained.</p></dd>

<dt><code>sample.size</code></dt><dd><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code><br />
The number of Monte Carlo samples for estimating the Shapley value.</p></dd>

</dl><p></div></p>
<h3>Returns</h3>
<p><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a><br />
<a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a> with the Shapley values (phi) per feature.</p>
<p><hr>
<a id="method-explain"></a></p><h3>Method <code>explain()</code></h3>
<p>Set a new data point which to explain.</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>Shapley</span>$<span class='fu'>explain</span>(<span class='no'>x.interest</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>x.interest</code></dt><dd><p><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a><br />
Single row with the instance to be explained.</p></dd>

</dl><p></div></p>
<p><hr>
<a id="method-clone"></a></p><h3>Method <code>clone()</code></h3>
<p>The objects of this class are cloneable with this method.</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>Shapley</span>$<span class='fu'>clone</span>(<span class='kw'>deep</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p></dd>

</dl><p></div></p>



    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"rpart"</span>)
<span class='co'># First we fit a machine learning model on the Boston housing data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"Boston"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"MASS"</span>)
<span class='no'>rf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/rpart/man/rpart.html'>rpart</a></span>(<span class='no'>medv</span> ~ <span class='no'>.</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>Boston</span>)
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='no'>Boston</span>[-<span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>Boston</span>) <span class='kw'>==</span> <span class='st'>"medv"</span>)]
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='no'>Predictor</span>$<span class='fu'>new</span>(<span class='no'>rf</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>X</span>)

<span class='co'># Then we explain the first instance of the dataset with the Shapley method:</span>
<span class='no'>x.interest</span> <span class='kw'>&lt;-</span> <span class='no'>X</span>[<span class='fl'>1</span>, ]
<span class='no'>shapley</span> <span class='kw'>&lt;-</span> <span class='no'>Shapley</span>$<span class='fu'>new</span>(<span class='no'>mod</span>, <span class='kw'>x.interest</span> <span class='kw'>=</span> <span class='no'>x.interest</span>)
<span class='no'>shapley</span></div><div class='output co'>#&gt; Interpretation method:  Shapley 
#&gt; Predicted value: 27.427273, Average prediction: 22.532806 (diff = 4.894466)
#&gt; 
#&gt; Analysed predictor: 
#&gt; Prediction task: unknown 
#&gt; 
#&gt; 
#&gt; Analysed data:
#&gt; Sampling from data.frame with 506 rows and 13 columns.
#&gt; 
#&gt; Head of results:
#&gt;   feature       phi  phi.var feature.value
#&gt; 1    crim 0.4127396  1.97886  crim=0.00632
#&gt; 2      zn 0.0000000  0.00000         zn=18
#&gt; 3   indus 0.0000000  0.00000    indus=2.31
#&gt; 4    chas 0.0000000  0.00000        chas=0
#&gt; 5     nox 0.0000000  0.00000     nox=0.538
#&gt; 6      rm 1.4808214 35.80714      rm=6.575</div><div class='input'>
<span class='co'># Look at the results in a table</span>
<span class='no'>shapley</span>$<span class='no'>results</span></div><div class='output co'>#&gt;    feature        phi   phi.var feature.value
#&gt; 1     crim  0.4127396  1.978860  crim=0.00632
#&gt; 2       zn  0.0000000  0.000000         zn=18
#&gt; 3    indus  0.0000000  0.000000    indus=2.31
#&gt; 4     chas  0.0000000  0.000000        chas=0
#&gt; 5      nox  0.0000000  0.000000     nox=0.538
#&gt; 6       rm  1.4808214 35.807141      rm=6.575
#&gt; 7      age  0.0000000  0.000000      age=65.2
#&gt; 8      dis -0.7017602  9.855057      dis=4.09
#&gt; 9      rad  0.0000000  0.000000         rad=1
#&gt; 10     tax  0.0000000  0.000000       tax=296
#&gt; 11 ptratio  0.0000000  0.000000  ptratio=15.3
#&gt; 12   black  0.0000000  0.000000   black=396.9
#&gt; 13   lstat  3.2841181 23.226452    lstat=4.98</div><div class='input'><span class='co'># Or as a plot</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>shapley</span>)</div><div class='img'><img src='Shapley-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Explain another instance</span>
<span class='no'>shapley</span>$<span class='fu'>explain</span>(<span class='no'>X</span>[<span class='fl'>2</span>, ])
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>shapley</span>)</div><div class='img'><img src='Shapley-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># Shapley() also works with multiclass classification</span>
<span class='no'>rf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/rpart/man/rpart.html'>rpart</a></span>(<span class='no'>Species</span> ~ <span class='no'>.</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>iris</span>)
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='no'>iris</span>[-<span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>iris</span>) <span class='kw'>==</span> <span class='st'>"Species"</span>)]
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='no'>Predictor</span>$<span class='fu'>new</span>(<span class='no'>rf</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>X</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"prob"</span>)

<span class='co'># Then we explain the first instance of the dataset with the Shapley() method:</span>
<span class='no'>shapley</span> <span class='kw'>&lt;-</span> <span class='no'>Shapley</span>$<span class='fu'>new</span>(<span class='no'>mod</span>, <span class='kw'>x.interest</span> <span class='kw'>=</span> <span class='no'>X</span>[<span class='fl'>1</span>, ])
<span class='no'>shapley</span>$<span class='no'>results</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>shapley</span>)

<span class='co'># You can also focus on one class</span>
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='no'>Predictor</span>$<span class='fu'>new</span>(<span class='no'>rf</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>X</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"prob"</span>, <span class='kw'>class</span> <span class='kw'>=</span> <span class='st'>"setosa"</span>)
<span class='no'>shapley</span> <span class='kw'>&lt;-</span> <span class='no'>Shapley</span>$<span class='fu'>new</span>(<span class='no'>mod</span>, <span class='kw'>x.interest</span> <span class='kw'>=</span> <span class='no'>X</span>[<span class='fl'>1</span>, ])
<span class='no'>shapley</span>$<span class='no'>results</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>shapley</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Christoph Molnar, Patrick Schratz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


