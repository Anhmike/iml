<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Feature importance — FeatureImp • iml</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Feature importance — FeatureImp" />
<meta property="og:description" content="FeatureImp computes feature importance for prediction models. The
importance is measured as the factor by which the model's prediction error
increases when the feature is shuffled." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">iml</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/intro.html">Introduction to iml: Interpretable Machine Learning in R</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel computation of interpretation methods</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/christophM/iml/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Feature importance</h1>
    <small class="dont-index">Source: <a href='https://github.com/christophM/iml/blob/master/R/FeatureImp.R'><code>R/FeatureImp.R</code></a></small>
    <div class="hidden name"><code>FeatureImp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>FeatureImp</code> computes feature importance for prediction models. The
importance is measured as the factor by which the model's prediction error
increases when the feature is shuffled.</p>
    </div>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>To compute the feature importance for a single feature, the model prediction
loss (error) is measured before and after shuffling the values of the
feature. By shuffling the feature values, the association between the outcome
and the feature is destroyed. The larger the increase in prediction error,
the more important the feature was. The shuffling is repeated to get more
accurate results, since the permutation feature importance tends to be quite
unstable.
Read the Interpretable Machine Learning book to learn about feature
importance in detail:
<a href='https://christophm.github.io/interpretable-ml-book/feature-importance.html'>https://christophm.github.io/interpretable-ml-book/feature-importance.html</a></p>
<p>The loss function can be either specified via a string, or by handing a
function to <code>FeatureImp()</code>. If you want to use your own loss function it
should have this signature:</p><pre>function(actual, predicted)
</pre>

<p>Using the string is
a shortcut to using loss functions from the <code>Metrics</code> package. Only use
functions that return a single performance value, not a vector. Allowed
losses are: <code>"ce"</code>, <code>"f1"</code>, <code>"logLoss"</code>, <code>"mae"</code>, <code>"mse"</code>, <code>"rmse"</code>, <code>"mape"</code>,
<code>"mdae"</code>, <code>"msle"</code>, <code>"percent_bias"</code>, <code>"rae"</code>, <code>"rmse"</code>, <code>"rmsle"</code>, <code>"rse"</code>,
<code>"rrse"</code> and <code>"smape"</code>.</p>
<p>See <code><a href='https://rdrr.io/pkg/Metrics/man'>library(help = "Metrics")</a></code> to get a list of functions.</p>
    <h2 class="hasAnchor" id="parallelization"><a class="anchor" href="#parallelization"></a>Parallelization</h2>

    

<p>Parallelization is supported via package <a href='https://CRAN.R-project.org/package=future'><span class="pkg">future</span></a>.
To initialize future-based parallelization, select an appropriate backend and
specify the amount of workers.
For example, to use a PSOCK based cluster backend do:<div class="r"></p><pre>future::plan(multisession, workers = 2)
&amp;lt;iml function here&amp;gt;
</pre><p></div></p>
<p>Consult the resources of the <a href='https://CRAN.R-project.org/package=future'><span class="pkg">future</span></a> package for more parallel
backend options.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Fisher, A., Rudin, C., and Dominici, F. (2018). Model Class Reliance:
Variable Importance Measures for any Machine Learning Model Class, from the
"Rashomon" Perspective. Retrieved from http://arxiv.org/abs/1801.01489</p>
    <h2 class="hasAnchor" id="super-class"><a class="anchor" href="#super-class"></a>Super class</h2>

    <p><code><a href='InterpretationMethod.html'>iml::InterpretationMethod</a></code> -&gt; <code>FeatureImp</code></p>
    <h2 class="hasAnchor" id="public-fields"><a class="anchor" href="#public-fields"></a>Public fields</h2>

    <p><div class="r6-fields"></p><dl'>
<dt><code>loss</code></dt><dd><p>(<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code> | <a href='https://rdrr.io/r/base/function.html'>function</a>)<br />
The loss function. Either the name of a loss (e.g. <code>"ce"</code> for
classification or <code>"mse"</code>) or a function.</p></dd>

<dt><code>original.error</code></dt><dd><p>(<code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code>)<br />
The loss of the model before perturbing features.</p></dd>

<dt><code>n.repetitions</code></dt><dd><p><a href='https://rdrr.io/r/base/integer.html'>integer</a><br />
Number of repetitions.</p></dd>

<dt><code>compare</code></dt><dd><p>(<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>)<br /> Either <code>"ratio"</code> or <code>"difference"</code>,
depending on whether the importance was calculated as difference
between original model error and model error after permutation or as
ratio.</p></dd>

</dl><p></div></p>
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    
<h3>Public methods</h3>

<ul>
<li><p><a href='#method-new'><code>FeatureImp$new()</code></a></p></li>
<li><p><a href='#method-clone'><code>FeatureImp$clone()</code></a></p></li>
</ul>
<p><details open ><summary>Inherited methods</summary>
<ul>
<li><p><span class="pkg-link" data-pkg="iml" data-topic="InterpretationMethod" data-id="plot"><a href='../../iml/html/InterpretationMethod.html#method-plot'><code>iml::InterpretationMethod$plot()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="iml" data-topic="InterpretationMethod" data-id="print"><a href='../../iml/html/InterpretationMethod.html#method-print'><code>iml::InterpretationMethod$print()</code></a></span></p></li>
</ul>
</details>

<hr>
<a id="method-new"></a></p><h3>Method <code>new()</code></h3>
<p>Create a FeatureImp object</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>FeatureImp</span>$<span class='fu'>new</span>(<span class='no'>predictor</span>, <span class='no'>loss</span>, <span class='kw'>compare</span> <span class='kw'>=</span> <span class='st'>"ratio"</span>, <span class='kw'>n.repetitions</span> <span class='kw'>=</span> <span class='fl'>5</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>predictor</code></dt><dd><p><a href='Predictor.html'>Predictor</a><br />
The object (created with <code>Predictor$new()</code>) holding the machine
learning model and the data.</p></dd>

<dt><code>loss</code></dt><dd><p>(<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code> | <a href='https://rdrr.io/r/base/function.html'>function</a>)<br />
The loss function. Either the name of a loss (e.g. <code>"ce"</code> for
classification or <code>"mse"</code>) or a function. See Details for allowed
losses.</p></dd>

<dt><code>compare</code></dt><dd><p>(<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>)<br />
Either <code>"ratio"</code> or <code>"difference"</code>.
Should importance be measured as the difference or as the ratio of
original model error and model error after permutation?
<ul>
<li><p>Ratio: error.permutation/error.orig</p></li>
<li><p>Difference: error.permutation - error.orig</p></li>
</ul></p></dd>

<dt><code>n.repetitions</code></dt><dd><p>(<code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code>)<br />
How often should the shuffling of the feature be repeated?
The higher the number of repetitions the more stable and accurate the
results become.</p></dd>

</dl><p></div></p>
<h3>Returns</h3>
<p>(data.frame)<br />
data.frame with the results of the feature importance computation. One
row per feature with the following columns:</p><ul>
<li><p>importance.05 (5% quantile of importance values from the repetitions)</p></li>
<li><p>importance (median importance)</p></li>
<li><p>importance.95 (95% quantile) and the permutation.error (median error
over all repetitions).</p></li>
</ul>

<p>The distribution of the importance is also visualized as a bar in the
plots, the median importance over the repetitions as a point.</p>
<p><hr>
<a id="method-clone"></a></p><h3>Method <code>clone()</code></h3>
<p>The objects of this class are cloneable with this method.</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>FeatureImp</span>$<span class='fu'>clone</span>(<span class='kw'>deep</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p></dd>

</dl><p></div></p>



    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"rpart"</span>)
<span class='co'># We train a tree on the Boston dataset:</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"Boston"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"MASS"</span>)
<span class='no'>tree</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/rpart/man/rpart.html'>rpart</a></span>(<span class='no'>medv</span> ~ <span class='no'>.</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>Boston</span>)
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>Boston</span>$<span class='no'>medv</span>
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='no'>Boston</span>[-<span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>Boston</span>) <span class='kw'>==</span> <span class='st'>"medv"</span>)]
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='no'>Predictor</span>$<span class='fu'>new</span>(<span class='no'>tree</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>X</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y</span>)


<span class='co'># Compute feature importances as the performance drop in mean absolute error</span>
<span class='no'>imp</span> <span class='kw'>&lt;-</span> <span class='no'>FeatureImp</span>$<span class='fu'>new</span>(<span class='no'>mod</span>, <span class='kw'>loss</span> <span class='kw'>=</span> <span class='st'>"mae"</span>)

<span class='co'># Plot the results directly</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>imp</span>)</div><div class='img'><img src='FeatureImp-1.png' alt='' width='700' height='433' /></div><div class='input'>

<span class='co'># Since the result is a ggplot object, you can extend it:</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"ggplot2"</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>imp</span>) + <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span>()</div><div class='img'><img src='FeatureImp-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># If you want to do your own thing, just extract the data:</span>
<span class='no'>imp.dat</span> <span class='kw'>&lt;-</span> <span class='no'>imp</span>$<span class='no'>results</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>imp.dat</span>)</div><div class='output co'>#&gt;   feature importance.05 importance importance.95 permutation.error
#&gt; 1      rm      2.096029   2.141674      2.224481          6.231631
#&gt; 2   lstat      1.779889   1.913461      2.021279          5.567602
#&gt; 3     dis      1.134231   1.187735      1.227171          3.455953
#&gt; 4    crim      1.123923   1.137653      1.152329          3.310231
#&gt; 5      zn      1.000000   1.000000      1.000000          2.909702
#&gt; 6   indus      1.000000   1.000000      1.000000          2.909702</div><div class='input'><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span>(<span class='no'>imp.dat</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>feature</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>importance</span>)) +
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span>() +
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span>()</div><div class='img'><img src='FeatureImp-3.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># We can also look at the difference in model error instead of the ratio</span>
<span class='no'>imp</span> <span class='kw'>&lt;-</span> <span class='no'>FeatureImp</span>$<span class='fu'>new</span>(<span class='no'>mod</span>, <span class='kw'>loss</span> <span class='kw'>=</span> <span class='st'>"mae"</span>, <span class='kw'>compare</span> <span class='kw'>=</span> <span class='st'>"difference"</span>)

<span class='co'># Plot the results directly</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>imp</span>)</div><div class='img'><img src='FeatureImp-4.png' alt='' width='700' height='433' /></div><div class='input'>

<span class='co'># FeatureImp also works with multiclass classification.</span>
<span class='co'># In this case, the importance measurement regards all classes</span>
<span class='no'>tree</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/rpart/man/rpart.html'>rpart</a></span>(<span class='no'>Species</span> ~ <span class='no'>.</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>iris</span>)
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='no'>iris</span>[-<span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>iris</span>) <span class='kw'>==</span> <span class='st'>"Species"</span>)]
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>iris</span>$<span class='no'>Species</span>
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='no'>Predictor</span>$<span class='fu'>new</span>(<span class='no'>tree</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>X</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"prob"</span>)

<span class='co'># For some models we have to specify additional arguments for the predict function</span>
<span class='no'>imp</span> <span class='kw'>&lt;-</span> <span class='no'>FeatureImp</span>$<span class='fu'>new</span>(<span class='no'>mod</span>, <span class='kw'>loss</span> <span class='kw'>=</span> <span class='st'>"ce"</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>imp</span>)</div><div class='img'><img src='FeatureImp-5.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># For multiclass classification models, you can choose to only compute</span>
<span class='co'># performance for one class.</span>
<span class='co'># Make sure to adapt y</span>
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='no'>Predictor</span>$<span class='fu'>new</span>(<span class='no'>tree</span>,
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>X</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y</span> <span class='kw'>==</span> <span class='st'>"virginica"</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"prob"</span>, <span class='kw'>class</span> <span class='kw'>=</span> <span class='st'>"virginica"</span>
)
<span class='no'>imp</span> <span class='kw'>&lt;-</span> <span class='no'>FeatureImp</span>$<span class='fu'>new</span>(<span class='no'>mod</span>, <span class='kw'>loss</span> <span class='kw'>=</span> <span class='st'>"ce"</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>imp</span>)</div><div class='img'><img src='FeatureImp-6.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Christoph Molnar, <a href='https://pat-s.me'>Patrick Schratz</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


